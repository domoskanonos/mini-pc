networks:
  local:
    driver: bridge

services:
  # --- AI Services ---
  ollama:
    image: docker.io/ollama/ollama:rocm
    container_name: ollama
    restart: unless-stopped
    devices:
      - "/dev/kfd:/dev/kfd"
      - "/dev/dri:/dev/dri"
    volumes:
      - ollama_data:/root/.ollama
    environment:
      - HSA_OVERRIDE_GFX_VERSION=10.3.0 # Wichtig für Ryzen 6000/7000 iGPUs
      - OLLAMA_NUM_PARALLEL=1        # Spart RAM bei großen Modellen
      - OLLAMA_MAX_LOADED_MODELS=1  # Verhindert, dass der RAM überläuft
    ports:
      - "8001:11434"
    networks:
      - local

  quisy-ai:
    image: docker.io/domoskanonos/quisy-ai:0.5.0
    container_name: quisy-ai
    restart: unless-stopped
    ports:
      - "8002:8000"
    environment:
      - AI_BACKEND=ollama
      - OLLAMA_BASE_URL=http://ollama:11434
      - LLM_MODEL=glm-4.7-flash:q4_K_M
      - APP_DIR=/app/data
      - LOG_LEVEL=INFO
    volumes:
      - quisy_ai_data:/app/data
    depends_on:
      - ollama
    networks:
      - local

  open-webui:
    image: ghcr.io/open-webui/open-webui:v0.8.5
    container_name: open-webui
    restart: unless-stopped
    ports:
      - "8003:8080"
    environment:
      - OLLAMA_BASE_URL=http://ollama:11434
      - OPENAI_API_BASE_URLS=http://quisy-ai:8000/v1
      - OPENAI_API_KEYS=sk-dummy
    volumes:
      - open-webui_data:/app/backend/data
    networks:
      - local

  # --- Dashboard & Tools ---
  flame:
    image: docker.io/pawelmalak/flame:multiarch
    container_name: flame
    restart: unless-stopped
    ports:
      - "8000:5005"
    volumes:
      - flame_data:/app/data
    environment:
      - BASE_URL=/
      - PASSWORD=${FLAME_PASSWORD}
      - PUID=1000
      - PGID=1000
    networks:
      - local

  dozzle:
    image: docker.io/amir20/dozzle:latest
    container_name: dozzle
    restart: unless-stopped
    ports:
      - "8004:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - local

  filebrowser:
    image: docker.io/filebrowser/filebrowser:latest
    container_name: filebrowser
    restart: unless-stopped
    ports:
      - "8005:80"
    volumes:
      - filebrowser_database:/database
      - filebrowser_config:/config
      - filebrowser_data:/srv
    environment:
      - FILEBROWSER_ADMIN_PASSWORD=${FILEBROWSER_PASSWORD}
    networks:
      - local

  # --- RSS ---
  freshrss:
    image: docker.io/freshrss/freshrss:latest
    container_name: freshrss
    restart: unless-stopped
    ports:
      - "8006:80"
    volumes:
      - freshrss_data:/var/www/FreshRSS/data
      - freshrss_extensions:/var/www/FreshRSS/extensions
    environment:
      - TZ=Europe/Berlin
      - CRON_MIN=1,31
      - ADMIN_PASSWORD=${FRESHRSS_PASSWORD}
    networks:
      - local

  # --- Backup ---
  duplicati:
    image: lscr.io/linuxserver/duplicati:latest
    container_name: duplicati
    restart: unless-stopped
    ports:
      - "8007:8200"
    volumes:
      - duplicati_config:/config
      #- /mnt/sd_card:/backups
      - ollama_data:/source/ollama:ro
      - quisy_ai_data:/source/quisy-ai:ro
      - open-webui_data:/source/open-webui:ro
      - flame_data:/source/flame:ro
      - filebrowser_database:/source/filebrowser/database:ro
      - filebrowser_config:/source/filebrowser/config:ro
      - filebrowser_data:/source/filebrowser/data:ro
      - freshrss_data:/source/freshrss/data:ro
      - freshrss_extensions:/source/freshrss/extensions:ro
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Berlin
      - DUPLICATI__WEBSERVICE_PASSWORD=${DUPLICATI_PASSWORD}
      - SETTINGS_ENCRYPTION_KEY=${DUPLICATI_PASSWORD}
    networks:
      - local

volumes:
  ollama_data:
  open-webui_data:
  quisy_ai_data:
  flame_data:
  filebrowser_database:
  filebrowser_config:
  filebrowser_data:
  duplicati_config:
  freshrss_data:
  freshrss_extensions: